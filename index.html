<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏ 6x6</title>
    <style>
        /* –í–∞—à—ñ —Å—Ç–∏–ª—ñ –±–µ–∑ –∑–º—ñ–Ω */
        body {
            font-family: sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 500px;
        }

        .active {
            display: block;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        input,
        button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 16px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:active {
            opacity: 0.8;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin: 20px 0;
        }

        .tile {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            padding: 3px;
            transition: transform 0.15s;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
        }

        .good {
            background: #fff;
            color: #000;
        }

        .bad {
            background: #000;
            color: #fff;
        }

        .empty {
            background: transparent;
            border: 1px dashed #ccc;
            cursor: default;
        }

        .bomb {
            background: #d32f2f;
            color: white;
            cursor: not-allowed;
        }

        .player-role {
            margin: 15px 0;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 450px) {
            .tile {
                font-size: 10px;
            }
        }
    </style>
</head>

<body>

    <!-- –ï–∫—Ä–∞–Ω —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏ -->
    <div id="team-screen" class="screen active">
        <h1>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏</h1>
        <div id="create-team">
            <input type="text" id="player-name" placeholder="–í–∞—à–µ —ñ–º'—è">
            <input type="text" id="team-name" placeholder="–ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏">
            <button onclick="createTeam()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É</button>
        </div>
        <div id="join-team" style="margin-top: 30px;">
            <h3>–ê–±–æ –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –∫–æ–º–∞–Ω–¥–∏:</h3>
            <input type="text" id="join-code" placeholder="–ö–æ–¥ –∫–æ–º–∞–Ω–¥–∏">
            <button onclick="joinTeam()">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è</button>
        </div>
    </div>

    <!-- –ï–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—ñ–≤ -->
    <div id="waiting-screen" class="screen">
        <h1>–û—á—ñ–∫—É—î–º–æ –≥—Ä–∞–≤—Ü—ñ–≤...</h1>
        <div id="team-code-display" style="font-size: 24px; text-align: center; margin: 20px 0;"></div>
        <div id="players-list"></div>
        <button onclick="startGame()" id="start-btn" disabled>–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π –µ–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
        <h1 id="team-name-display"></h1>
        <div id="player-role" class="player-role"></div>
        <div id="game"></div>
        <div id="instructions"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js"></script>
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const firebaseConfig = {
    apiKey: "AIzaSyCoGZn0wvV0ulsHY210udC7q1p3cTuScHk",
    authDomain: "nenasytna-poroshnecha.firebaseapp.com",
    projectId: "nenasytna-poroshnecha",
    storageBucket: "nenasytna-poroshnecha.firebasestorage.app",
    messagingSenderId: "752057294970",
    appId: "1:752057294970:web:72729b43c584a21214dbc3",
    measurementId: "G-X25N330RMM"
  };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≥—Ä–∏
        const FINAL_ORDER = ['–¢—ñ–∫ –¢–æ–∫', '–†—ñ–ª—Å–∏', '–ë—Ä–∞–≤–ª –°—Ç–∞—Ä—Å', '–Ü–Ω—Å—Ç–∞–≥—Ä–∞–º', '–Æ—Ç—É–± –®–æ—Ä—Ç—Å', '–°–Ω–∞–ø—á–∞—Ç'];
        const gridSize = 6;
        const BOMB = 'üí£';

        // –î–∞–Ω—ñ –≥—Ä–∏
        const goodTiles = [
            '–ü—Ä–æ–≥—É–ª—è—Ç–∏—Å—è', '–ü–æ—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è', '–î–æ–ø–æ–º–æ–≥—Ç–∏ –±–∞—Ç—å–∫–∞–º', '–°–ø–æ—Ä—Ç',
            '–ö–Ω–∏–≥–∞', '–ú–æ–ª–∏—Ç–≤–∞', '–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è', '–ú—É–∑–∏–∫–∞',
            '–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è', '–°–æ–Ω', '–£—Ä–æ–∫–∏', '–ù–∞—Å—Ç—ñ–ª—å–Ω—ñ —ñ–≥—Ä–∏',
            '–•–æ–±—ñ', '–ù–æ–≤–µ —Å–ª–æ–≤–æ', '–ú–∞–ª—é–≤–∞–Ω–Ω—è', '–ó–∞—Ä—è–¥–∫–∞',
            '–õ–∏—Å—Ç', '–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞', '–ì–æ—Ç—É–≤–∞–Ω–Ω—è', '–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Ñ—ñ–ª—å–º'
        ];

        const badTiles = [...FINAL_ORDER];

        // –°—Ç–∞–Ω –≥—Ä–∏
        let currentScreen = 'team';
        let playerId = '';
        let teamId = '';
        let playerName = '';
        let isBlindPlayer = false;
        let tiles = [];
        let bombPosition = -1;

        // –ï–ª–µ–º–µ–Ω—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
        const screens = {
            team: document.getElementById('team-screen'),
            waiting: document.getElementById('waiting-screen'),
            game: document.getElementById('game-screen')
        };

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏
        function createTeam() {
            playerName = document.getElementById('player-name').value.trim();
            const teamName = document.getElementById('team-name').value.trim();

            if (!playerName || !teamName) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ –Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏");
                return;
            }

            // –ì–µ–Ω–µ—Ä—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–¥ –∫–æ–º–∞–Ω–¥–∏
            teamId = 'team_' + Math.random().toString(36).substr(2, 8);

            // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –∫–æ–º–∞–Ω–¥—É –≤ Firebase
            const newTeamRef = database.ref('teams/' + teamId);
            newTeamRef.set({
                name: teamName,
                players: [{
                    id: 'player_' + Math.random().toString(36).substr(2, 8),
                    name: playerName,
                    isBlind: false
                }],
                gameState: null,
                isPlaying: false
            });

            playerId = 'player_' + Math.random().toString(36).substr(2, 8);

            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–¥ –∫–æ–º–∞–Ω–¥–∏ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
            document.getElementById('team-code-display').textContent = `–ö–æ–¥ –∫–æ–º–∞–Ω–¥–∏: ${teamId}`;
            updatePlayersList();
            showScreen('waiting');

            // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ –∫–æ–∂–Ω—ñ 2 —Å–µ–∫—É–Ω–¥–∏
            setInterval(() => {
                if (currentScreen === 'waiting') {
                    updatePlayersList();
                    checkGameStart();
                }
            }, 2000);
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫–æ–º–∞–Ω–¥–∏
        function joinTeam() {
            playerName = document.getElementById('player-name').value.trim();
            const joinCode = document.getElementById('join-code').value.trim();

            if (!playerName || !joinCode) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ –∫–æ–¥ –∫–æ–º–∞–Ω–¥–∏");
                return;
            }

            teamId = joinCode;

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î –∫–æ–º–∞–Ω–¥–∞ –≤ Firebase
            const teamRef = database.ref('teams/' + teamId);
            teamRef.once('value', (snapshot) => {
                const teamData = snapshot.val();

                if (!teamData) {
                    alert("–ö–æ–º–∞–Ω–¥–∞ –∑ —Ç–∞–∫–∏–º –∫–æ–¥–æ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞");
                    return;
                }

                playerId = 'player_' + Math.random().toString(36).substr(2, 8);

                // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –≥—Ä–∞–≤—Ü—è –¥–æ –∫–æ–º–∞–Ω–¥–∏ –≤ Firebase
                const playersRef = teamRef.child('players');
                playersRef.push({
                    id: playerId,
                    name: playerName,
                    isBlind: false
                });

                showScreen('waiting');
                updatePlayersList();

                // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ –∫–æ–∂–Ω—ñ 2 —Å–µ–∫—É–Ω–¥–∏
                setInterval(() => {
                    if (currentScreen === 'waiting') {
                        updatePlayersList();
                        checkGameStart();
                    }
                }, 2000);
            });
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≥—Ä–∞–≤—Ü—ñ–≤
        function updatePlayersList() {
            const teamRef = database.ref('teams/' + teamId);
            teamRef.once('value', (snapshot) => {
                const teamData = snapshot.val();
                if (!teamData) return;

                const playersList = document.getElementById('players-list');
                playersList.innerHTML = '<h3>–ì—Ä–∞–≤—Ü—ñ –≤ –∫–æ–º–∞–Ω–¥—ñ:</h3>' +
                    teamData.players.map(p => `<div>${p.name}</div>`).join('');

                // –¢—ñ–ª—å–∫–∏ –ø–µ—Ä—à–∏–π –≥—Ä–∞–≤–µ—Ü—å –º–æ–∂–µ –ø–æ—á–∞—Ç–∏ –≥—Ä—É
                document.getElementById('start-btn').disabled =
                    teamData.players[0].id !== playerId || teamData.players.length < 3;
            });
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –º–æ–∂–Ω–∞ –ø–æ—á–∞—Ç–∏ –≥—Ä—É
        function checkGameStart() {
            const teamRef = database.ref('teams/' + teamId);
            teamRef.once('value', (snapshot) => {
                const teamData = snapshot.val();
                if (teamData && !teamData.isPlaying) {
                    startGame();
                }
            });
        }

        // –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
        function startGame() {
            const teamRef = database.ref('teams/' + teamId);
            teamRef.once('value', (snapshot) => {
                const teamData = snapshot.val();
                if (!teamData) return;

                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –≥—Ä–∏ –≤ '–≥—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è'
                teamRef.update({ isPlaying: true });
                showScreen('game');

                tiles = generateTiles();
                bombPosition = Math.floor(Math.random() * (gridSize * gridSize));
                renderTiles();
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–ª–∏—Ç–æ–∫ –¥–ª—è –≥—Ä–∏
        function generateTiles() {
            const allTiles = goodTiles.concat(badTiles);
            while (allTiles.length < gridSize * gridSize) {
                allTiles.push('üü¶');
            }
            return shuffle(allTiles).slice(0, gridSize * gridSize);
        }

        // –ü–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—É
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–ª–∏—Ç–æ–∫ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
        function renderTiles() {
            const gameContainer = document.getElementById('game');
            gameContainer.innerHTML = '';
            tiles.forEach((tile, index) => {
                const tileElement = document.createElement('div');
                tileElement.classList.add('tile');
                tileElement.textContent = tile;
                tileElement.onclick = () => tileClick(index);
                gameContainer.appendChild(tileElement);
            });
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –ø–æ –ø–ª–∏—Ç—Ü—ñ
        function tileClick(index) {
            const tile = tiles[index];

            if (index === bombPosition) {
                alert('–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –í–∏ –Ω–∞—Ç—Ä–∞–ø–∏–ª–∏ –Ω–∞ –≤–∏–±—É—Ö!');
                resetGame();
            } else {
                tiles[index] = '‚úÖ';
                renderTiles();
            }
        }

        // –°–∫–∏–¥–∞–Ω–Ω—è –≥—Ä–∏
        function resetGame() {
            tiles = [];
            bombPosition = -1;
            showScreen('team');
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –µ–∫—Ä–∞–Ω
        function showScreen(screenName) {
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
            });
            screens[screenName].classList.add('active');
            currentScreen = screenName;
        }
    </script>
</body>

</html>
