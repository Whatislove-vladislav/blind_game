<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏ 6x6</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }
        
        .screen {
            display: none;
            width: 100%;
            max-width: 500px;
        }
        
        .active {
            display: block;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 16px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        
        button:active {
            opacity: 0.8;
        }
        
        .role-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .role-buttons button {
            flex: 1;
        }
        
        #game {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        
        .tile {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            padding: 3px;
            transition: transform 0.15s;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
        }
        
        .good {
            background: #fff;
            color: #000;
        }
        
        .bad {
            background: #000;
            color: #fff;
        }
        
        .empty {
            background: transparent;
            border: 1px dashed #ccc;
            cursor: default;
        }
        
        .bomb {
            background: #d32f2f;
            color: white;
            cursor: not-allowed;
        }
        
        .player-role {
            margin: 15px 0;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }
        
        #room-info {
            font-size: 18px;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 6px;
        }
        
        @media (max-width: 450px) {
            .tile {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ä–æ–ª—ñ -->
    <div id="role-screen" class="screen active">
        <h1>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏</h1>
        <input type="text" id="player-name" placeholder="–í–∞—à–µ —ñ–º'—è">
        <div class="role-buttons">
            <button onclick="joinAsBlind()">–°–ª—ñ–ø–∏–π (1 –≥—Ä–∞–≤–µ—Ü—å)</button>
            <button onclick="joinAsLeader()">–ö–µ—Ä—ñ–≤–Ω–∏–∫ (2 –≥—Ä–∞–≤—Ü—ñ)</button>
        </div>
    </div>

    <!-- –ï–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è -->
    <div id="waiting-screen" class="screen">
        <h1>–û—á—ñ–∫—É—î–º–æ –≥—Ä–∞–≤—Ü—ñ–≤...</h1>
        <div id="room-info"></div>
        <div id="players-list"></div>
    </div>

    <!-- –Ü–≥—Ä–æ–≤–∏–π –µ–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
        <h1>–ì—Ä–∞ —Ç—Ä–∏–≤–∞—î!</h1>
        <div id="player-role" class="player-role"></div>
        <div id="game"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js"></script>
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCoGZn0wvV0ulsHY210udC7q1p3cTuScHk",
            authDomain: "nenasytna-poroshnecha.firebaseapp.com",
            projectId: "nenasytna-poroshnecha",
            storageBucket: "nenasytna-poroshnecha.appspot.com",
            messagingSenderId: "752057294970",
            appId: "1:752057294970:web:72729b43c584a21214dbc3",
            measurementId: "G-X25N330RMM"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≥—Ä–∏
        const FINAL_ORDER = ['–¢—ñ–∫ –¢–æ–∫', '–†—ñ–ª—Å–∏', '–ë—Ä–∞–≤–ª –°—Ç–∞—Ä—Å', '–Ü–Ω—Å—Ç–∞–≥—Ä–∞–º', '–Æ—Ç—É–± –®–æ—Ä—Ç—Å', '–°–Ω–∞–ø—á–∞—Ç'];
        const gridSize = 6;
        const BOMB = 'üí£';

        // –°—Ç–∞–Ω –≥—Ä–∏
        let playerId = '';
        let playerName = '';
        let roomId = '';
        let playerRole = '';
        let isHost = false;
        let tiles = [];
        let bombPosition = -1;

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —è–∫ –°–ª—ñ–ø–∏–π
        function joinAsBlind() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è");
                return;
            }
            playerRole = 'blind';
            findOrCreateRoom();
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —è–∫ –ö–µ—Ä—ñ–≤–Ω–∏–∫
        function joinAsLeader() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è");
                return;
            }
            playerRole = 'leader';
            findOrCreateRoom();
        }

        // –ü–æ—à—É–∫ –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏
        function findOrCreateRoom() {
            playerId = 'player_' + Math.random().toString(36).substr(2, 8);
            
            database.ref('rooms').once('value', (snapshot) => {
                let foundRoom = false;
                
                snapshot.forEach((roomSnapshot) => {
                    const room = roomSnapshot.val();
                    
                    // –Ø–∫—â–æ –∫—ñ–º–Ω–∞—Ç–∞ —â–µ –Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞
                    if (!room.isFull) {
                        // –î–ª—è —Å–ª—ñ–ø–∏—Ö - —à—É–∫–∞—î–º–æ –∫—ñ–º–Ω–∞—Ç—É –±–µ–∑ —Å–ª—ñ–ø–æ–≥–æ
                        if (playerRole === 'blind' && room.blindCount === 0) {
                            joinRoom(roomSnapshot.key);
                            foundRoom = true;
                            return;
                        }
                        // –î–ª—è –∫–µ—Ä—ñ–≤–Ω–∏–∫—ñ–≤ - —à—É–∫–∞—î–º–æ –∫—ñ–º–Ω–∞—Ç—É –∑ –º–µ–Ω—à –Ω—ñ–∂ 2 –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞–º–∏
                        else if (playerRole === 'leader' && room.leaderCount < 2) {
                            joinRoom(roomSnapshot.key);
                            foundRoom = true;
                            return;
                        }
                    }
                });
                
                // –Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π—à–ª–∏ –ø—ñ–¥—Ö–æ–¥—è—á—É –∫—ñ–º–Ω–∞—Ç—É - —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É
                if (!foundRoom) {
                    createNewRoom();
                }
            });
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –∫—ñ–º–Ω–∞—Ç–∏
        function createNewRoom() {
            roomId = 'room_' + Math.random().toString(36).substr(2, 8);
            isHost = true;
            
            const roomData = {
                blindCount: playerRole === 'blind' ? 1 : 0,
                leaderCount: playerRole === 'leader' ? 1 : 0,
                players: {
                    [playerId]: {
                        name: playerName,
                        role: playerRole
                    }
                },
                isFull: false,
                gameStarted: false
            };
            
            database.ref('rooms/' + roomId).set(roomData);
            setupRoomListeners();
            showWaitingScreen();
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ —ñ—Å–Ω—É—é—á–æ—ó –∫—ñ–º–Ω–∞—Ç–∏
        function joinRoom(existingRoomId) {
            roomId = existingRoomId;
            const updates = {};
            
            updates[`/rooms/${roomId}/players/${playerId}`] = {
                name: playerName,
                role: playerRole
            };
            
            if (playerRole === 'blind') {
                updates[`/rooms/${roomId}/blindCount`] = firebase.database.ServerValue.increment(1);
            } else {
                updates[`/rooms/${roomId}/leaderCount`] = firebase.database.ServerValue.increment(1);
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫—ñ–º–Ω–∞—Ç–∞ —Ç–µ–ø–µ—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–∞
            database.ref(`rooms/${roomId}`).once('value').then((snapshot) => {
                const room = snapshot.val();
                const blindFull = room.blindCount + (playerRole === 'blind' ? 1 : 0) >= 1;
                const leadersFull = room.leaderCount + (playerRole === 'leader' ? 1 : 0) >= 2;
                
                if (blindFull && leadersFull) {
                    updates[`/rooms/${roomId}/isFull`] = true;
                }
                
                database.ref().update(updates);
                setupRoomListeners();
                showWaitingScreen();
            });
        }

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –∑–º—ñ–Ω —É –∫—ñ–º–Ω–∞—Ç—ñ
        function setupRoomListeners() {
            const roomRef = database.ref(`rooms/${roomId}`);
            
            roomRef.on('value', (snapshot) => {
                const room = snapshot.val();
                if (!room) return;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('room-info').textContent = 
                    `–ö—ñ–º–Ω–∞—Ç–∞: ${roomId}\n–°–ª—ñ–ø–∏—Ö: ${room.blindCount || 0}, –ö–µ—Ä—ñ–≤–Ω–∏–∫—ñ–≤: ${room.leaderCount || 0}`;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤
                const playersList = document.getElementById('players-list');
                playersList.innerHTML = '<h3>–ì—Ä–∞–≤—Ü—ñ:</h3>';
                
                for (const [id, player] of Object.entries(room.players || {})) {
                    playersList.innerHTML += `<div>${player.name} (${player.role === 'blind' ? '–°–ª—ñ–ø–∏–π' : '–ö–µ—Ä—ñ–≤–Ω–∏–∫'})</div>`;
                }
                
                // –Ø–∫—â–æ –∫—ñ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞ —ñ –≥—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è
                if (room.isFull && room.gameStarted) {
                    startGame();
                }
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –µ–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
        function showWaitingScreen() {
            document.getElementById('role-screen').classList.remove('active');
            document.getElementById('waiting-screen').classList.add('active');
        }

        // –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
        function startGame() {
            document.getElementById('waiting-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            
            document.getElementById('player-role').textContent = 
                `–í–∏ ${playerRole === 'blind' ? '–°–ª—ñ–ø–∏–π' : '–ö–µ—Ä—ñ–≤–Ω–∏–∫'}: ${playerName}`;
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ –≥—Ä—É
            generateGame();
            renderTiles();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≥—Ä–∏
        function generateGame() {
            const allTiles = [
                '–ü—Ä–æ–≥—É–ª—è—Ç–∏—Å—è', '–ü–æ—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è', '–î–æ–ø–æ–º–æ–≥—Ç–∏ –±–∞—Ç—å–∫–∞–º', '–°–ø–æ—Ä—Ç',
                '–ö–Ω–∏–≥–∞', '–ú–æ–ª–∏—Ç–≤–∞', '–ü—Ä–∏–±–∏—Ä–∞–Ω–Ω—è', '–ú—É–∑–∏–∫–∞',
                '–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è', '–°–æ–Ω', '–£—Ä–æ–∫–∏', '–ù–∞—Å—Ç—ñ–ª—å–Ω—ñ —ñ–≥—Ä–∏',
                '–•–æ–±—ñ', '–ù–æ–≤–µ —Å–ª–æ–≤–æ', '–ú–∞–ª—é–≤–∞–Ω–Ω—è', '–ó–∞—Ä—è–¥–∫–∞',
                '–õ–∏—Å—Ç', '–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞', '–ì–æ—Ç—É–≤–∞–Ω–Ω—è', '–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∏–π —Ñ—ñ–ª—å–º',
                ...FINAL_ORDER
            ];
            
            // –î–æ–¥–∞—î–º–æ –ø—É—Å—Ç—ñ –ø–ª–∏—Ç–∫–∏, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
            while (allTiles.length < gridSize * gridSize) {
                allTiles.push('üü¶');
            }
            
            // –ü–µ—Ä–µ–º—ñ—à—É—î–º–æ —Ç–∞ –æ–±–∏—Ä–∞—î–º–æ –±–æ–º–±—É
            tiles = shuffle(allTiles).slice(0, gridSize * gridSize);
            bombPosition = Math.floor(Math.random() * tiles.length);
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–ª–∏—Ç–æ–∫
        function renderTiles() {
            const gameContainer = document.getElementById('game');
            gameContainer.innerHTML = '';
            
            tiles.forEach((tile, index) => {
                const tileElement = document.createElement('div');
                tileElement.className = 'tile';
                tileElement.textContent = tile;
                
                if (index === bombPosition) {
                    tileElement.classList.add('bomb');
                } else if (FINAL_ORDER.includes(tile)) {
                    tileElement.classList.add('bad');
                } else {
                    tileElement.classList.add('good');
                }
                
                tileElement.onclick = () => handleTileClick(index);
                gameContainer.appendChild(tileElement);
            });
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—É –Ω–∞ –ø–ª–∏—Ç–∫—É
        function handleTileClick(index) {
            if (index === bombPosition) {
                alert('–ë–£–ú! –í–∏ –ø—Ä–æ–≥—Ä–∞–ª–∏!');
                resetGame();
            } else {
                tiles[index] = '‚úÖ';
                renderTiles();
            }
        }

        // –°–∫–∏–¥–∞–Ω–Ω—è –≥—Ä–∏
        function resetGame() {
            database.ref(`rooms/${roomId}`).remove();
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('role-screen').classList.add('active');
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—É
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
