<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏ 6x6 (–ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è)</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 500px;
        }

        .active {
            display: block;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 16px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:active {
            opacity: 0.8;
        }

        .role-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .role-buttons button {
            flex: 1;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin: 20px 0;
        }

        .tile {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            text-align: center;
            padding: 3px;
            transition: transform 0.15s;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
        }

        .good {
            background: #fff;
            color: #000;
        }

        .bad {
            background: #000;
            color: #fff;
        }

        .empty {
            background: transparent;
            border: 1px dashed #ccc;
            cursor: default;
        }

        .bomb {
            background: #d32f2f;
            color: white;
            cursor: not-allowed;
        }

        .player-role {
            margin: 15px 0;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 450px) {
            .tile {
                font-size: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- –ï–∫—Ä–∞–Ω –≤–∏–±–æ—Ä—É —Ä–æ–ª—ñ -->
    <div id="role-screen" class="screen active">
        <h1>–ö–æ–º–∞–Ω–¥–Ω—ñ –ü'—è—Ç–Ω–∞—à–∫–∏</h1>
        <input type="text" id="player-name" placeholder="–í–∞—à–µ —ñ–º'—è">
        <div class="role-buttons">
            <button onclick="joinAsBlind()">–°–ª—ñ–ø–∏–π (1 –≥—Ä–∞–≤–µ—Ü—å)</button>
            <button onclick="joinAsLeader()">–ö–µ—Ä—ñ–≤–Ω–∏–∫ (2 –≥—Ä–∞–≤—Ü—ñ)</button>
        </div>
    </div>

    <!-- –ï–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≥—Ä–∞–≤—Ü—ñ–≤ -->
    <div id="waiting-screen" class="screen">
        <h1>–û—á—ñ–∫—É—î–º–æ –≥—Ä–∞–≤—Ü—ñ–≤...</h1>
        <div id="team-info"></div>
        <div id="players-list"></div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π –µ–∫—Ä–∞–Ω -->
    <div id="game-screen" class="screen">
        <h1 id="team-name-display"></h1>
        <div id="player-role" class="player-role"></div>
        <div id="game"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js"></script>
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCoGZn0wvV0ulsHY210udC7q1p3cTuScHk",
            authDomain: "nenasytna-poroshnecha.firebaseapp.com",
            projectId: "nenasytna-poroshnecha",
            storageBucket: "nenasytna-poroshnecha.appspot.com",
            messagingSenderId: "752057294970",
            appId: "1:752057294970:web:72729b43c584a21214dbc3"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≥—Ä–∏
        const FINAL_ORDER = ['–¢—ñ–∫ –¢–æ–∫', '–†—ñ–ª—Å–∏', '–ë—Ä–∞–≤–ª –°—Ç–∞—Ä—Å', '–Ü–Ω—Å—Ç–∞–≥—Ä–∞–º', '–Æ—Ç—É–± –®–æ—Ä—Ç—Å', '–°–Ω–∞–ø—á–∞—Ç'];
        const gridSize = 6;
        const BOMB = 'üí£';

        // –°—Ç–∞–Ω –≥—Ä–∏
        let playerId = '';
        let playerName = '';
        let teamId = '';
        let playerRole = '';
        let currentRoom = '';

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —è–∫ –°–ª—ñ–ø–∏–π (1 –≥—Ä–∞–≤–µ—Ü—å)
        function joinAsBlind() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è");
                return;
            }
            playerRole = 'blind';
            findOrCreateRoom();
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è —è–∫ –ö–µ—Ä—ñ–≤–Ω–∏–∫ (2 –≥—Ä–∞–≤—Ü—ñ)
        function joinAsLeader() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è");
                return;
            }
            playerRole = 'leader';
            findOrCreateRoom();
        }

        // –ü–æ—à—É–∫ –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏
        function findOrCreateRoom() {
            const roomsRef = database.ref('rooms');
            
            roomsRef.once('value', (snapshot) => {
                let foundRoom = false;
                
                // –®—É–∫–∞—î–º–æ –∫—ñ–º–Ω–∞—Ç—É, –¥–µ —â–µ —î –º—ñ—Å—Ü–µ
                snapshot.forEach((roomSnapshot) => {
                    const room = roomSnapshot.val();
                    
                    // –Ø–∫—â–æ –∫—ñ–º–Ω–∞—Ç–∞ —â–µ –Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞
                    if (!room.isFull) {
                        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å —Ü—è –∫—ñ–º–Ω–∞—Ç–∞ –¥–ª—è –≥—Ä–∞–≤—Ü—è
                        if (
                            (playerRole === 'blind' && room.blindPlayers < 1) ||
                            (playerRole === 'leader' && room.leaderPlayers < 2)
                        ) {
                            foundRoom = true;
                            currentRoom = roomSnapshot.key;
                            joinRoom(currentRoom);
                            return;
                        }
                    }
                });
                
                // –Ø–∫—â–æ –≤—ñ–ª—å–Ω–æ—ó –∫—ñ–º–Ω–∞—Ç–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ - —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É
                if (!foundRoom) {
                    createNewRoom();
                }
            });
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –∫—ñ–º–Ω–∞—Ç–∏
        function createNewRoom() {
            const newRoomRef = database.ref('rooms').push();
            currentRoom = newRoomRef.key;
            
            const roomData = {
                blindPlayers: playerRole === 'blind' ? 1 : 0,
                leaderPlayers: playerRole === 'leader' ? 1 : 0,
                players: {
                    [playerId]: {
                        name: playerName,
                        role: playerRole
                    }
                },
                isFull: false,
                isPlaying: false
            };
            
            newRoomRef.set(roomData);
            
            playerId = 'player_' + Math.random().toString(36).substr(2, 8);
            showWaitingScreen();
            setupRoomListener();
        }

        // –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ —ñ—Å–Ω—É—é—á–æ—ó –∫—ñ–º–Ω–∞—Ç–∏
        function joinRoom(roomId) {
            const roomRef = database.ref('rooms/' + roomId);
            
            roomRef.transaction((room) => {
                if (!room) return room;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—ñ–≤
                if (playerRole === 'blind') {
                    room.blindPlayers = (room.blindPlayers || 0) + 1;
                } else {
                    room.leaderPlayers = (room.leaderPlayers || 0) + 1;
                }
                
                // –î–æ–¥–∞—î–º–æ –≥—Ä–∞–≤—Ü—è –¥–æ —Å–ø–∏—Å–∫—É
                room.players = room.players || {};
                room.players[playerId] = {
                    name: playerName,
                    role: playerRole
                };
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫—ñ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞
                if (room.blindPlayers >= 1 && room.leaderPlayers >= 2) {
                    room.isFull = true;
                }
                
                return room;
            });
            
            playerId = 'player_' + Math.random().toString(36).substr(2, 8);
            showWaitingScreen();
            setupRoomListener();
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
        function showWaitingScreen() {
            document.getElementById('role-screen').classList.remove('active');
            document.getElementById('waiting-screen').classList.add('active');
            updatePlayersList();
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≥—Ä–∞–≤—Ü—ñ–≤
        function updatePlayersList() {
            const roomRef = database.ref('rooms/' + currentRoom);
            roomRef.on('value', (snapshot) => {
                const room = snapshot.val();
                if (!room) return;
                
                const playersList = document.getElementById('players-list');
                playersList.innerHTML = '<h3>–ì—Ä–∞–≤—Ü—ñ –≤ –∫—ñ–º–Ω–∞—Ç—ñ:</h3>';
                
                for (const [id, player] of Object.entries(room.players || {})) {
                    playersList.innerHTML += `<div>${player.name} (${player.role === 'blind' ? '–°–ª—ñ–ø–∏–π' : '–ö–µ—Ä—ñ–≤–Ω–∏–∫'})</div>`;
                }
                
                document.getElementById('team-info').textContent = 
                    `–ö—ñ–º–Ω–∞—Ç–∞: ${currentRoom}\n–°–ª—ñ–ø–∏—Ö: ${room.blindPlayers || 0}, –ö–µ—Ä—ñ–≤–Ω–∏–∫—ñ–≤: ${room.leaderPlayers || 0}`;
            });
        }

        // –°–ª—É—Ö–∞—á –∑–º—ñ–Ω —É –∫—ñ–º–Ω–∞—Ç—ñ
        function setupRoomListener() {
            const roomRef = database.ref('rooms/' + currentRoom);
            
            roomRef.on('value', (snapshot) => {
                const room = snapshot.val();
                if (!room) return;
                
                // –Ø–∫—â–æ –∫—ñ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω–∞ —ñ –≥—Ä–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è
                if (room.isFull && room.isPlaying) {
                    startGame();
                }
            });
        }

        // –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏
        function startGame() {
            const roomRef = database.ref('rooms/' + currentRoom);
            
            roomRef.once('value', (snapshot) => {
                const room = snapshot.val();
                if (!room) return;
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–ª—å –≥—Ä–∞–≤—Ü—è
                const playerData = room.players[playerId];
                document.getElementById('player-role').textContent = 
                    `–í–∞—à–∞ —Ä–æ–ª—å: ${playerData.role === 'blind' ? '–°–ª—ñ–ø–∏–π' : '–ö–µ—Ä—ñ–≤–Ω–∏–∫'}`;
                
                // –ì–µ–Ω–µ—Ä—É—î–º–æ –≥—Ä—É (—Å–ø—Ä–æ—â–µ–Ω–æ)
                generateGame();
                
                // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–≥—Ä–æ–≤–∏–π –µ–∫—Ä–∞–Ω
                document.getElementById('waiting-screen').classList.remove('active');
                document.getElementById('game-screen').classList.add('active');
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≥—Ä–∏ (—Å–ø—Ä–æ—â–µ–Ω–æ)
        function generateGame() {
            // –¢—É—Ç –º–∞—î –±—É—Ç–∏ –≤–∞—à–∞ –ª–æ–≥—ñ–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≥—Ä–∏
            // –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∏—Ç–æ–∫, —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –±–æ–º–±–∏ —Ç–æ—â–æ
            console.log("–ì—Ä–∞ –ø–æ—á–∞–ª–∞—Å—è!");
        }

        // –ü–æ–∫–∞–∑—É—î–º–æ –µ–∫—Ä–∞–Ω
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenName).classList.add('active');
        }
    </script>
</body>
</html>
